<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>我的路书</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
    <script src="https://api.map.baidu.com/api?v=2.0&ak=K4lj4WauSIagEIiRkVY0lVt6IGgR6WM4"></script>
<style type="text/css">*{margin:0;padding:0;box-sizing:border-box;-webkit-touch-callout:none}body{font-family:BlinkMacSystemFont,'Segoe UI','PingFang SC','Hiragino Sans GB','Microsoft YaHei','Helvetica Neue',Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:14px}a{color:inherit;outline:0}li,ul{list-style:none}img{-webkit-touch-callout:none;touch-action:none}button{outline:0;appearance:none;box-shadow:none;border:none;font-size:16px;cursor:pointer;transition:opacity .2s}button:not([disabled]):hover{opacity:.8}::selection{color:#fff;background-color:#1376e6}#map,body,html{width:100%;height:100%;overflow:hidden}.locations,.panel{color:#fff;position:absolute}.panel{top:20px;left:20px;width:250px;font-weight:300}.panel>div{margin-bottom:12px;padding:8px 12px;border-radius:4px;background-color:rgba(19,118,230,.5)}.panel .curr{background-color:rgba(251,64,69,.5);transition:opacity 1s ease-in-out}.locations{bottom:20px;left:50%;transform:translateX(-50%);min-width:320px;padding:12px 20px;border-radius:4px;font-weight:300;background-color:rgba(19,118,230,.5);z-index:100;transition:opacity .5s ease-in-out}.locations .province{margin:8px 0}.locations .city{cursor:pointer;text-decoration:underline}.locations .close{position:absolute;top:10px;right:15px;font-size:18px;cursor:pointer}.hide .curr,.locations.hide{display:none}.shortcut{width:70px;padding:3px 3px 0}.shortcut img{max-width:100%;max-height:100%;vertical-align:middle;z-index:500;cursor:pointer}.shortcut::before{content:'';position:absolute;left:32px;bottom:-5px;width:10px;height:10px;transform:rotate(45deg);background:#fff;z-index:-1}.shortcut p{color:#666;text-align:center;font-weight:600;padding:5px 0}.BMapLabel{border:1px solid #eee!important;box-shadow:0 1px 6px rgba(0,0,0,.2)}.modal{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:space-around;padding:30px;background:rgba(77,77,77,.6);z-index:1000;transition:opacity .5s}.modal .image-original{max-width:50%}.modal .image-original img{max-height:520px;max-width:100%}.modal .image-info p{margin-bottom:32px;color:#fff;font-size:16px;font-weight:200}.modal .hide-btn{position:absolute;right:30px;top:20px;font-size:32px;font-weight:300;color:#fff;cursor:pointer}.modal .hide-btn:hover{color:#ccc}.invisible{opacity:0;pointer-events:none}.copyright{position:absolute;right:20px;bottom:20px;color:#a6a6a6;font-weight:400;font-size:12px}.toggle-images{position:absolute;top:40px;right:10px;border-radius:4px;padding:6px 12px;font-size:12px;color:#fff;cursor:pointer}.toggle-images.hidden{display:none}.toggle-images.enable{background:#16be6b}.toggle-images.disable{background:#ed4040}</style></head>
<body>
    <div id="map"></div>
    <div class="panel hide" id="panel">
        <div>总里程：<span id="distance"></span> km</div>
        <div>总时长：<span id="time"></span></div>
        <div class="curr">当次里程：<span id="curr_distance"></span> km</div>
        <div class="curr">运动时长：<span id="curr_time"></span></div>
        <div class="curr">出发时刻：<span id="start_time"></span></div>
    </div>
    <div class="locations">
        走过的地方
        <div class="province">省：<span id="provinces"></span></div>
        <div class="cities">市：<span id="cities"></span></div>
        <span class="close" id="close">×</span>
    </div>
    <div class="modal invisible" id="modal">
        <div class="image-original">
            <img id="photo">
        </div>
        <div class="image-info">
            <p>经度：<span id="longitude"></span>N</p>
            <p>纬度：<span id="latitude"></span>E</p>
            <p>海拔：<span id="altitude"></span>m</p>
            <p>摄于：<span id="create-time"></span></p>
        </div>
        <div class="hide-btn" id="hide">×</div>
    </div>
    <div class="copyright">
        Made by <a href="//github.com/shenlvmeng/roadmap" target="_blank" rel="noopener noreferrer">roadmap</a>
    </div>
    <div id="toggle" class="toggle-images disable hidden">关闭图片展示</div>
<script>!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),o=n(2);n(3);let a,i,c=0,u=0;const l=[],s=[];let f=!0,d=[];const p=[],h=t=>document.querySelector(t);function y(t){return r.__awaiter(this,void 0,void 0,function*(){const e=new XMLHttpRequest;return new Promise((n,r)=>{e.open("GET",t),e.onload=()=>n(JSON.parse(e.responseText)),e.onerror=()=>r(e.statusText),e.send()})})}function m(t){return t>31536e3?`${~~(t/315636e3)}年 ${m(t%31536e3)}`:t>2592e3?`${~~(t/2592e3)}月 ${m(t%2592e3)}`:t>86400?`${~~(t/86400)}天 ${m(t%86400)}`:t>3600?`${~~(t/3600)}h ${m(t%3600)}`:t>60?`${~~(t/60)}m ${m(t%60)}`:`${t.toFixed(0)}s`}function g(t){const e=t.city,n=t.province;n&&-1===l.indexOf(n)&&l.push(n),e&&-1===s.indexOf(e)&&s.push(e),h("#provinces").innerHTML=l.map(t=>t.slice(0,-1)).join(", "),h("#cities").innerHTML=s.map(t=>`<span class="city">${t.slice(0,-1)}</span>`).join(", ")}function v(){a&&(a.setStrokeColor("#3a6bdb"),h("#panel").className+=" hide",a=null)}function M(t){return r.__awaiter(this,void 0,void 0,function*(){const e=yield y(`./data/${t}.json`);c+=e.distance,u+=e.duration;const n=e.points.map(t=>new BMap.Point(t.lon,t.lat)),r=new BMap.Polyline(n,{enableMassClear:!1});r.metadata={distance:e.distance,duration:e.duration,startTime:e.startTime},r.addEventListener("click",t=>{v(),t.target.setStrokeColor("#ed4040");const e=t.target.metadata;h("#curr_distance").innerHTML=e.distance.toFixed(3),h("#curr_time").innerHTML=m(e.duration/1e3),h("#start_time").innerHTML=new Date(e.startTime).toLocaleString(),h("#panel").className="panel",a=t.target,t.domEvent.stopPropagation()}),i.addOverlay(r),(new BMap.Geocoder).getLocation(n[0],t=>{g(t.addressComponents)}),(new BMap.Geocoder).getLocation(n[~~(n.length/2)],t=>{g(t.addressComponents)}),(new BMap.Geocoder).getLocation(n[n.length-1],t=>{g(t.addressComponents)}),h("#distance").innerHTML=c.toFixed(3),h("#time").innerHTML=m(u/1e3)})}function _(t){return t[0]+t[1]/60+t[2]/3600}function b(){p.forEach(t=>{const e=o.wgs2bd({lat:t.latitude,lon:t.longitude}),n=new BMap.Point(e.lon,e.lat),r=`<div class="shortcut" title="摄于${t.time}" data-key="${t.title}">\n            <img src='./data/images/${t.title}.jpg' />\n            <p>海拔 ${t.altitude.toFixed(1)}m</p>\n        </div>`,a=new BMap.Label(r,{position:n,offset:new BMap.Size(-38,t.vertical?-134:-90)});i.addOverlay(a)})}function w(t){d.push(t.key),"shenlvmeng"===d.join("")?(h("#toggle").classList.remove("hidden"),document.removeEventListener("keyup",w)):"shenlvmeng".includes(d.join(""))||(d=[])}!function(){r.__awaiter(this,void 0,void 0,function*(){const t=yield y("./roadmap.config.json"),{city:e,title:n,gpxCount:r,imgTitles:o=[]}=t;if(!e||!n||!r)throw Error("roadmap.config.json格式错误");document.title=n||"我的路书",(i=new BMap.Map("map")).centerAndZoom(e||"北京"),i.addControl(new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]})),i.enableScrollWheelZoom(!0),i.addEventListener("click",()=>{v()}),h("#cities").addEventListener("click",t=>{(t.target.className="city")&&i.centerAndZoom(t.target.innerText)}),h("#close").addEventListener("click",t=>{t.target.parentNode.className+=" hide"});for(let t=0;t<r;t+=1)M(t);o.length&&(yield Promise.all(o.map(t=>new Promise(e=>{const n=new Image;n.src=`./data/images/${t}.jpg`,n.onload=()=>{EXIF.getData(n,function(){EXIF.getTag(this,"GPSLatitude")?(p.push({title:t,vertical:this.height>=150,time:EXIF.getTag(this,"DateTime"),altitude:EXIF.getTag(this,"GPSAltitude").valueOf(),latitude:_(EXIF.getTag(this,"GPSLatitude")),longitude:_(EXIF.getTag(this,"GPSLongitude"))}),e()):e()})}}))),b(),h("#map").addEventListener("click",t=>{let e=t.target;if(e.dataset.key||(e=e.parentNode),e.dataset.key){let t;if(p.forEach(n=>{n.title===e.dataset.key&&(t=n)}),!t)return;h("#modal").classList.remove("invisible"),h("#altitude").innerHTML=t.altitude.toFixed(3),h("#longitude").innerHTML=t.longitude.toFixed(5),h("#latitude").innerHTML=t.latitude.toFixed(5),h("#photo").src=`https://s2.ax1x.com/${e.dataset.key.replace(/-/g,"/")}.jpg`,h("#create-time").innerHTML=`${t.time.slice(0,11).replace(/:/g,"-")}${t.time.slice(11)}`}}),h("#hide").addEventListener("click",()=>{h("#modal").classList.add("invisible")}),document.addEventListener("keyup",w),h("#toggle").addEventListener("click",()=>{f=!f,h("#toggle").innerHTML=f?"关闭图片展示":"开启图片展示",h("#toggle").className=f?"toggle-images disable":"toggle-images enable",f?b():i.clearOverlays()}))})}()},function(t,e,n){"use strict";n.r(e),n.d(e,"__extends",function(){return o}),n.d(e,"__assign",function(){return a}),n.d(e,"__rest",function(){return i}),n.d(e,"__decorate",function(){return c}),n.d(e,"__param",function(){return u}),n.d(e,"__metadata",function(){return l}),n.d(e,"__awaiter",function(){return s}),n.d(e,"__generator",function(){return f}),n.d(e,"__exportStar",function(){return d}),n.d(e,"__values",function(){return p}),n.d(e,"__read",function(){return h}),n.d(e,"__spread",function(){return y}),n.d(e,"__spreadArrays",function(){return m}),n.d(e,"__await",function(){return g}),n.d(e,"__asyncGenerator",function(){return v}),n.d(e,"__asyncDelegator",function(){return M}),n.d(e,"__asyncValues",function(){return _}),n.d(e,"__makeTemplateObject",function(){return b}),n.d(e,"__importStar",function(){return w}),n.d(e,"__importDefault",function(){return O});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function c(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i}function u(t,e){return function(n,r){e(n,r,t)}}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function s(t,e,n,r){return new(n||(n=Promise))(function(o,a){function i(t){try{u(r.next(t))}catch(t){a(t)}}function c(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,c)}u((r=r.apply(t,e||[])).next())})}function f(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function d(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function p(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,a=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}function m(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var a=arguments[e],i=0,c=a.length;i<c;i++,o++)r[o]=a[i];return r}function g(t){return this instanceof g?(this.v=t,this):new g(t)}function v(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(t){o[t]&&(r[t]=function(e){return new Promise(function(n,r){a.push([t,e,n,r])>1||c(t,e)})})}function c(t,e){try{(n=o[t](e)).value instanceof g?Promise.resolve(n.value.v).then(u,l):s(a[0][2],n)}catch(t){s(a[0][3],t)}var n}function u(t){c("next",t)}function l(t){c("throw",t)}function s(t,e){t(e),a.shift(),a.length&&c(a[0][0],a[0][1])}}function M(t){var e,n;return e={},r("next"),r("throw",function(t){throw t}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,o){e[r]=t[r]?function(e){return(n=!n)?{value:g(t[r](e)),done:"return"===r}:o?o(e):e}:o}}function _(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=p(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,o){(function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)})(r,o,(e=t[n](e)).done,e.value)})}}}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function w(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function O(t){return t&&t.__esModule?t:{default:t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=3.141592653589793,o=52.35987755982988;function a(t,e){const n=6378245,o=.006693421622965943;let a=function(t,e){let n=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*r)+20*Math.sin(2*t*r))/3,n+=2*(20*Math.sin(e*r)+40*Math.sin(e/3*r))/3,n+=2*(160*Math.sin(e/12*r)+320*Math.sin(e*r/30))/3}(e-105,t-35),i=function(t,e){let n=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*r)+20*Math.sin(2*t*r))/3,n+=2*(20*Math.sin(t*r)+40*Math.sin(t/3*r))/3,n+=2*(150*Math.sin(t/12*r)+300*Math.sin(t/30*r))/3}(e-105,t-35);const c=t/180*r;let u=Math.sin(c);u=1-o*u*u;const l=Math.sqrt(u);return{lat:a=180*a/(n*(1-o)/(u*l)*r),lon:i=180*i/(n/l*Math.cos(c)*r)}}function i(t,e){if(u(t,e))return{lat:t,lon:e};const n=a(t,e);return{lat:t+n.lat,lon:e+n.lon}}function c(t,e){const n=e,r=t,a=Math.sqrt(n*n+r*r)+2e-5*Math.sin(r*o),i=Math.atan2(r,n)+3e-6*Math.cos(n*o),c=a*Math.cos(i)+.0065;return{lat:a*Math.sin(i)+.006,lon:c}}function u(t,e){return e<72.004||e>137.8347||(t<.8293||t>55.8271)}e.gcj_decrypt=function(t,e){if(u(t,e))return{lat:t,lon:e};const n=a(t,e);return{lat:t-n.lat,lon:e-n.lon}},e.gcj_decrypt_exact=function(t,e){let n,r,o=.01,a=.01,c=t-o,u=e-a,l=t+o,s=e+a,f=0;for(;;){const d=i(n=(c+l)/2,r=(u+s)/2);if(o=d.lat-t,a=d.lon-e,Math.abs(o)<1e-9&&Math.abs(a)<1e-9)break;if(o>0?l=n:c=n,a>0?s=r:u=r,++f>1e4)break}return{lat:n,lon:r}},e.bd_encrypt=c,e.bd_decrypt=function(t,e){const n=e-.0065,r=t-.006,a=Math.sqrt(n*n+r*r)-2e-5*Math.sin(r*o),i=Math.atan2(r,n)-3e-6*Math.cos(n*o),c=a*Math.cos(i);return{lat:a*Math.sin(i),lon:c}},e.mercator_encrypt=function(t,e){const n=20037508.34*e/180;let o=Math.log(Math.tan((90+t)*r/360))/(r/180);return{lat:o=20037508.34*o/180,lon:n}},e.mercator_decrypt=function(t,e){const n=e/20037508.34*180;let o=t/20037508.34*180;return{lat:o=180/r*(2*Math.atan(Math.exp(o*r/180))-r/2),lon:n}},e.distance=function(t,e,n,o){let a=Math.cos(t*r/180)*Math.cos(n*r/180)*Math.cos((e-o)*r/180)+Math.sin(t*r/180)*Math.sin(n*r/180);return a>1&&(a=1),a<-1&&(a=-1),6371e3*Math.acos(a)},e.wgs2bd=function(t){const{lat:e,lon:n}=t,r=i(e,n);return c(r.lat,r.lon)}},function(t,e,n){}]);</script></body>
</html>